<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
        div {
            display: flex;
            flex-wrap: wrap;
        }
        .primes {
            padding: 0.5em;
            height: 5px;
        }
        .squares {
            width: 1000px;

        }
        .square {
            width: 10px;
            height:7px;
        }

        .black{
            background-color: black;
        }
        a{
            margin-right: 15px;
        }
    </style>
    
    <script src="js/class.js"></script>

    <title>Document</title>
</head>
<body>
    <a href="?d=720">Draw Spiral</a>
    <a href="?n=10000">Primes (n)</a>
    <a href="?p=10000">Primes map</a>
    <a href="?s=10000">Squares map</a>
    <div>

    </div>

    <canvas>

    </canvas>

    <script>
        const div = document.querySelector('div');
        const c = document.querySelector("canvas");
        c.width = innerHeight;
        c.height = innerHeight;
        var ctx = c.getContext("2d");

        const params = new URLSearchParams(location.search);

        const drawCircle = () => {
            ctx.beginPath();
            ctx.arc(100, 75, 50, 0, 2 * Math.PI);
            ctx.arc(100, 75, 40, 0, 2 * Math.PI);
            ctx.stroke();
        }

        /*
        * on the spiral, only number rays ending in 1,3,7 and 9 can have a prime number
        * so, if we take that ray and all of it numbers and spiral plot the numbers from it, we could
        * determine which of those is in the 1,3,7,9 and possibly calculate the primes
        */
        const drawSpiral = () => {
            //


            var centerx = ctx.canvas.width / 2;
            var centery = ctx.canvas.height / 2;

            var x = 1;
            var a = x;
            var b = x;

            ctx.clearRect(0, 0, innerHeight, innerHeight);

            ctx.moveTo(centerx, centery);
            ctx.beginPath();
            ctx.font = '7px arial';

            var deg = +params.get("d");
            var factor = +params.get("f") || 0.628311;

            for (i = 0; i < deg; i++) {



                angle = factor * i;



                x = centerx + (a + b * angle) * Math.cos(angle);
                y = centery + (a + b * angle) * Math.sin(angle);

                //console.log(i, x, y);

                ctx.lineTo(x, y);


                
                isPrime(i) && ctx.fillText(i, x, y);
                
                
            }

            ctx.strokeStyle = "#000";
            ctx.stroke();

        }

        
        const isPrime = (num) =>{
            for(let i = 2, s = Math.sqrt(num); i <= s; i++){
                if(num % i === 0) return false; 
            }
            return num > 1;
        }
        

        const drawPrimes = (arr) =>{

            for(var n of arr){
                div.insertAdjacentHTML('beforeend', `<span>${n},</span>`);
            }

        }

        const getPrimes = (n) =>{

            var arr = [];

            for(var i = 0; i<=n; i++){
                if(isPrime(i)){
                    arr.push(i);
                }
            }

            return arr;

        }

        const getRay = (primes) =>{

            var arr = [[],[],[],[],[],[],[],[],[],[]];

            for(var n of primes){

                let idx = +(n+'').slice(-1)[0];

                arr[idx].push(n);
                
            }


            return arr;

        }

        const getGaps = (arr) =>{

            var gaps = [];
            var high = 0;

            for (var i in arr){

                if(i>0){
                    let gap = arr[i] - arr[i-1];
                    gaps.push(gap);

                    high = gap>high ? gap : high;

                
                }

            }

            return [high, gaps];

        }

        const fillPrimes = (n) =>{

            let p = getPrimes(n);

            console.log(p);

            for(var i=0; i<=n; i++){

                p.indexOf(i) > -1 ?
                div.insertAdjacentHTML("beforeend", `<span class='primes white' id='${i}'>&nbsp;</span>`) :
                div.insertAdjacentHTML("beforeend", `<span class='primes black' id='${i}'>&nbsp;</span>`) ;


            }


        }

        const fillSquares = (n) =>{

            div.classList.add('squares');
            
            for(var i=0; i<=n; i++){

                i % Math.sqrt(i) ?
                div.insertAdjacentHTML("beforeend", `<span class='square black' id='${i}'>&nbsp;</span>`) :
                div.insertAdjacentHTML("beforeend", `<span class='square white' id='${i}'>&nbsp;</span>`) ;


            }


        }



        +params.get("d") && drawSpiral();
        +params.get("n") && drawPrimes(getPrimes(+params.get("n")));
        +params.get("p") && fillPrimes(+params.get("p"));
        +params.get("s") && fillSquares(+params.get("s"));



    </script>
</body>
</html>